<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <link type="text/css" th:href="@{/css/chart.css}" rel="stylesheet">
    <link type="text/css" th:href="@{/css/main.css}" rel="stylesheet">
    <link type="text/css" th:href="@{/css/portfolio.css}" rel="stylesheet">
    <link rel="icon" type="image/png" th:href="@{/images/logo.png}">
    <title>AlgoView - 포트폴리오</title>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo"><a href="/">Algo-View</a></div>
            <nav class="nav-menu">
                <a href="/">대시보드</a>
                <a href="/chart">차트 분석</a>
                <a href="/backtest">백테스트</a>
                <a href="/portfolio" class="active">포트폴리오</a> </nav>
            <div class="user-actions">
                <th:block sec:authorize="isAuthenticated()">
                    <span class="user-info"><span sec:authentication="name">User</span>님</span>
                    <button class="btn-logout" onclick="location.href='/user/logout'">로그아웃</button>
                </th:block>
            </div>
        </div>
    </header>

    <div class="wrapper" style="max-width: 1200px; margin: 40px auto;">
        
        <div class="summary-grid">
            <div class="summary-card">
                <div class="summary-label">총 매수 금액</div>
                <div class="summary-value" id="totalInvested">0 원</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">총 평가 금액</div>
                <div class="summary-value" id="totalValue">0 원</div>
            </div>
            <div class="summary-card">
                <div class="summary-label">총 평가 손익</div>
                <div class="summary-value" id="totalProfit">0 원</div>
                <div id="totalRate" style="font-size: 14px; margin-top: 5px;">0.00%</div>
            </div>
        </div>

        <div style="overflow: hidden; margin-bottom: 10px;">
            <h2 style="float: left; margin: 0;">보유 종목 현황</h2>
            <button class="btn-add" onclick="openAddModal()">+ 종목 추가</button>
        </div>

        <div class="content-card">
            <table class="stock-table pf-table">
                <thead>
                    <tr>
                        <th>종목명</th>
                        <th>보유수량</th>
                        <th>매수평단가</th>
                        <th>현재가</th>
                        <th>평가금액</th>
                        <th>평가손익</th>
                        <th>수익률</th>
                        <th style="text-align: center;">관리</th>
                    </tr>
                </thead>
                <tbody id="portfolioList">
                    </tbody>
            </table>
        </div>
    </div>

    <div id="addModal" class="pf-modal-overlay">
        <div class="pf-modal-content">
            <div class="pf-modal-header">
                <h3>💰 보유 종목 추가</h3>
                <span class="close-btn" onclick="closeAddModal()">×</span>
            </div>
            
            <div class="pf-modal-body">
                <label class="form-label">종목 검색</label>
                <div class="input-group">
                    <input type="text" id="pSearchInput" class="form-input" placeholder="종목명 또는 코드 입력 (예: 삼성)" onkeyup="if(window.event.keyCode==13){searchStock()}">
                    <button class="btn-search" onclick="searchStock()">검색</button>
                    <ul id="pSearchResult" class="search-results"></ul>
                </div>
                
                <label class="form-label">선택된 종목</label>
                <div style="margin-bottom: 20px;">
                    <input type="text" id="selectedStockName" class="form-input" readonly placeholder="위에서 검색 후 선택해주세요">
                    <input type="hidden" id="selectedStockCode">
                </div>

                <div class="row-group">
                    <div style="flex: 1;">
                        <label class="form-label">매수 평균가 (원)</label>
                        <input type="number" id="buyPrice" class="form-input" placeholder="0">
                    </div>
                    <div style="flex: 1;">
                        <label class="form-label">보유 수량 (주)</label>
                        <input type="number" id="quantity" class="form-input" placeholder="0">
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeAddModal()">취소</button>
                <button class="btn-save" onclick="submitPortfolio()">저장하기</button>
            </div>
        </div>
    </div>

     <script type="text/javascript" src="js/portfolio.js"></script>
</body>
</html>
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"> <!-- â­ï¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì¶”ê°€ -->
<head>
    <meta charset="UTF-8">
    <title>StockSight - ëŒ€ì‹œë³´ë“œ</title>
    <style>
        /* --- ê³µí†µ ìŠ¤íƒ€ì¼ (ì°¨íŠ¸ í˜ì´ì§€ì™€ í†µì¼) --- */
        :root {
            --primary-color: #2962FF;
            --up-color: #e11d48;
            --down-color: #2563eb;
            --bg-color: #f4f6f8;
            --card-bg: #ffffff;
            --text-main: #333;
            --text-sub: #666;
        }

        body {
            font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            color: var(--text-main);
        }

        a { text-decoration: none; color: inherit; }
        ul { list-style: none; padding: 0; margin: 0; }

        /* --- ë ˆì´ì•„ì›ƒ --- */
        .wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- í—¤ë” (ë„¤ë¹„ê²Œì´ì…˜) --- */
        header {
            background: var(--card-bg);
            padding: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 24px;
            font-weight: 900;
            color: var(--primary-color);
            letter-spacing: -1px;
        }
        .nav-menu { display: flex; gap: 20px; font-size: 15px; font-weight: 600; color: var(--text-sub); }
        .nav-menu a:hover { color: var(--primary-color); }
        .user-actions { display: flex; align-items: center; gap: 10px; }
        .user-actions button {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            border: none;
        }
        .btn-login { background: var(--primary-color); color: white; }
        .btn-logout { background: #e0e0e0; color: #333; }
        .user-info { font-size: 14px; font-weight: 600; color: var(--text-main); margin-right: 5px; }

        /* --- ê²€ìƒ‰ íˆì–´ë¡œ ì„¹ì…˜ --- */
        .hero-section {
            text-align: center;
            margin-bottom: 40px;
        }
        .hero-title { font-size: 28px; font-weight: 700; margin-bottom: 20px; }
        .search-box {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }
        .search-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: all 0.3s;
            outline: none;
        }
        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(41, 98, 255, 0.15);
        }

        /* --- ì‹œì¥ ì§€ìˆ˜ ì¹´ë“œ (KOSPI, KOSDAQ) --- */
        .market-indices {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .index-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }
        .index-name { font-size: 14px; color: var(--text-sub); margin-bottom: 5px; }
        .index-value { font-size: 24px; font-weight: 800; }
        .index-change { font-size: 14px; font-weight: 600; margin-left: 10px; }
        .card-chart-mini { height: 50px; margin-top: 10px; opacity: 0.5; } /* ë¯¸ë‹ˆ ì°¨íŠ¸ ì˜ì—­ */

        /* --- ë©”ì¸ ì½˜í…ì¸  ê·¸ë¦¬ë“œ (ìˆœìœ„ & ê´€ì‹¬ì¢…ëª©) --- */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr; /* 2:1 ë¹„ìœ¨ */
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid { grid-template-columns: 1fr; }
        }

        .content-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .card-title { font-size: 18px; font-weight: 700; }
        .more-link { font-size: 13px; color: var(--text-sub); cursor: pointer; }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .stock-table { width: 100%; border-collapse: collapse; }
        .stock-table th { text-align: left; font-size: 13px; color: #888; padding: 10px 5px; font-weight: 500; }
        .stock-table td { padding: 12px 5px; font-size: 15px; border-bottom: 1px solid #f8f8f8; }
        .stock-table tr:last-child td { border-bottom: none; }
        .stock-table tr:hover { background-color: #f9f9f9; cursor: pointer; }
        
        .rank-badge {
            display: inline-block; width: 20px; height: 20px; 
            background: #eee; color: #555; 
            border-radius: 4px; text-align: center; line-height: 20px; font-size: 12px; font-weight: bold;
            margin-right: 8px;
        }
        .rank-1 { background: #FFD700; color: white; }
        .rank-2 { background: #C0C0C0; color: white; }
        .rank-3 { background: #CD7F32; color: white; }

        .up { color: var(--up-color); }
        .down { color: var(--down-color); }
        .stock-name { font-weight: 600; }
        .stock-code { font-size: 12px; color: #999; margin-left: 5px; }

        /* ê²€ìƒ‰ ê²°ê³¼ ë“œë¡­ë‹¤ìš´ (ì°¨íŠ¸ í˜ì´ì§€ì™€ ë™ì¼) */
        #searchResult {
            position: absolute; top: 100%; left: 0; right: 0;
            background: white; border: 1px solid #ddd; border-radius: 0 0 15px 15px;
            max-height: 200px; overflow-y: auto; z-index: 100; display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        #searchResult li { padding: 12px 20px; cursor: pointer; border-bottom: 1px solid #f0f0f0; }
        #searchResult li:hover { background-color: #f5f5f5; color: var(--primary-color); }

    </style>
</head>
<body>

    <!-- í—¤ë” -->
    <header>
        <div class="header-content">
            <div class="logo"><a href="/">Chart Pattern Finder</a></div>
            <nav class="nav-menu">
                <a href="/">ëŒ€ì‹œë³´ë“œ</a>
                <a href="/chart">ì°¨íŠ¸ ë¶„ì„</a>
                <a href="#">ë°±í…ŒìŠ¤íŠ¸</a> <!-- ì¶”í›„ êµ¬í˜„ -->
                <a href="#">í¬íŠ¸í´ë¦¬ì˜¤</a>
            </nav>
            <div class="user-actions">
                <!-- â­ï¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ í™œìš©: sec:authorize ì‚¬ìš© -->
                
                <!-- ë¡œê·¸ì¸ ì•ˆ ëœ ê²½ìš° -->
                <button sec:authorize="isAnonymous()" class="btn-login" onclick="location.href='/user/login'">ë¡œê·¸ì¸</button>
                
                <!-- ë¡œê·¸ì¸ ëœ ê²½ìš° -->
                <th:block sec:authorize="isAuthenticated()">
                    <!-- ì¸ì¦ ê°ì²´ì—ì„œ ì´ë¦„ ê°€ì ¸ì˜¤ê¸° -->
                    <span class="user-info"><span sec:authentication="name">User</span>ë‹˜</span>
                    <button class="btn-logout" onclick="location.href='/user/logout'">ë¡œê·¸ì•„ì›ƒ</button>
                </th:block>
            </div>
        </div>
    </header>

    <div class="wrapper">
        <!-- íˆì–´ë¡œ (ê²€ìƒ‰) -->
        <section class="hero-section">
            <div class="hero-title">ì–´ë–¤ ì¢…ëª©ì„ ë¶„ì„í•´ ë“œë¦´ê¹Œìš”?</div>
            <div class="search-box">
                <input type="text" id="searchInput" class="search-input" placeholder="ì¢…ëª©ëª… ë˜ëŠ” ì½”ë“œ ê²€ìƒ‰ (ì˜ˆ: ì‚¼ì„±ì „ì)" autocomplete="off">
                <ul id="searchResult"></ul>
            </div>
        </section>

        <!-- ì‹œì¥ ì§€ìˆ˜ (Mock Data) -->
        <section class="market-indices">
            <div class="index-card">
                <div class="index-name">KOSPI</div>
                <div class="index-value up">2,650.32</div>
                <div class="index-change up">â–² 12.45 (+0.47%)</div>
                <!-- ì—¬ê¸°ì— ë¯¸ë‹ˆ ì°¨íŠ¸(SVG) ë„£ì„ ìˆ˜ ìˆìŒ -->
            </div>
            <div class="index-card">
                <div class="index-name">KOSDAQ</div>
                <div class="index-value down">870.15</div>
                <div class="index-change down">â–¼ 3.20 (-0.37%)</div>
            </div>
            <div class="index-card">
                <div class="index-name">USD/KRW</div>
                <div class="index-value">1,340.50</div>
                <div class="index-change up">â–² 5.00 (+0.37%)</div>
            </div>
        </section>

        <!-- ë©”ì¸ ì½˜í…ì¸  ê·¸ë¦¬ë“œ (ìˆœìœ„ & ê´€ì‹¬ì¢…ëª©) -->
        <div class="dashboard-grid">
            <!-- ì™¼ìª½: ì‹¤ì‹œê°„ ê¸‰ìƒìŠ¹ -->
            <div class="content-card">
                <div class="card-header">
                    <div class="card-title">ğŸ”¥ ì‹¤ì‹œê°„ ê¸‰ìƒìŠ¹ TOP 5</div>
                    <div class="more-link">ë”ë³´ê¸° ></div>
                </div>
                <table class="stock-table">
                    <thead>
                        <tr>
                            <th width="50">ìˆœìœ„</th>
                            <th>ì¢…ëª©ëª…</th>
                            <th style="text-align: right;">í˜„ì¬ê°€</th>
                            <th style="text-align: right;">ë“±ë½ë¥ </th>
                        </tr>
                    </thead>
                    <tbody id="rankingList">
                        <!-- JSë¡œ ë°ì´í„° ë¡œë”© -->
                    </tbody>
                </table>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ë‚´ ê´€ì‹¬ì¢…ëª© -->
            <div class="content-card">
                <div class="card-header">
                    <div class="card-title">â­ ë‚˜ì˜ ê´€ì‹¬ ì¢…ëª©</div>
                    <div class="more-link">ê´€ë¦¬</div>
                </div>
                <table class="stock-table">
                    <thead>
                        <tr>
                            <th>ì¢…ëª©ëª…</th>
                            <th style="text-align: right;">í˜„ì¬ê°€</th>
                            <th style="text-align: right;">ë“±ë½ë¥ </th>
                        </tr>
                    </thead>
                    <tbody id="watchlist">
                        <!-- JSë¡œ ë°ì´í„° ë¡œë”© -->
                    </tbody>
                </table>
                <!-- ë¡œê·¸ì¸ ì•ˆë˜ì–´ ìˆì„ ì‹œ -->
                <!-- <div style="text-align: center; padding: 20px; color: #999;">ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</div> -->
            </div>
        </div>
    </div>

    <script>
        // --- ë”ë¯¸ ë°ì´í„° (ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œ APIì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨) ---
        const mockRankings = [
            { code: '005930', name: 'ì‚¼ì„±ì „ì', price: 78000, change: 1.5 },
            { code: '000660', name: 'SKí•˜ì´ë‹‰ìŠ¤', price: 142000, change: 3.2 },
            { code: '035420', name: 'NAVER', price: 205000, change: -0.5 },
            { code: '035720', name: 'ì¹´ì¹´ì˜¤', price: 54300, change: -1.2 },
            { code: '005380', name: 'í˜„ëŒ€ì°¨', price: 240500, change: 2.8 }
        ];

        const mockWatchlist = [
            { code: '005930', name: 'ì‚¼ì„±ì „ì', price: 78000, change: 1.5 },
            { code: '035720', name: 'ì¹´ì¹´ì˜¤', price: 54300, change: -1.2 },
            { code: '000270', name: 'ê¸°ì•„', price: 110000, change: 0.8 }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            renderTable('rankingList', mockRankings, true);
            renderTable('watchlist', mockWatchlist, false);
            
            // ê²€ìƒ‰ì°½ ì´ë²¤íŠ¸ ì—°ê²° (ê¸°ì¡´ ì°¨íŠ¸ í˜ì´ì§€ API í™œìš©)
            setupSearch();
        });

        function renderTable(elementId, data, showRank) {
            const tbody = document.getElementById(elementId);
            tbody.innerHTML = '';

            data.forEach((item, index) => {
                const row = document.createElement('tr');
                const rankClass = index < 3 ? `rank-${index+1}` : '';
                const rankHtml = showRank ? `<td><span class="rank-badge ${rankClass}">${index + 1}</span></td>` : '';
                
                const colorClass = item.change > 0 ? 'up' : (item.change < 0 ? 'down' : '');
                const sign = item.change > 0 ? '+' : '';

                row.innerHTML = `
                    ${rankHtml}
                    <td>
                        <span class="stock-name">${item.name}</span>
                        <span class="stock-code">${item.code}</span>
                    </td>
                    <td style="text-align: right; font-weight: 500;">${item.price.toLocaleString()}</td>
                    <td style="text-align: right;" class="${colorClass}">
                        ${sign}${item.change}%
                    </td>
                `;
                
                // í´ë¦­ ì‹œ ì°¨íŠ¸ í˜ì´ì§€ë¡œ ì´ë™
                row.onclick = () => {
                    window.location.href = `/chart?code=${item.code}`; // (í˜„ì¬ ì°¨íŠ¸ í˜ì´ì§€ê°€ ì½”ë“œ íŒŒë¼ë¯¸í„°ë¥¼ ë°›ë„ë¡ ìˆ˜ì • í•„ìš”)
                    // í˜¹ì€ localStorageì— ì €ì¥í•˜ê³  ì´ë™
                    localStorage.setItem('selectedCode', item.code);
                    localStorage.setItem('selectedName', item.name);
                    window.location.href = '/chart';
                };

                tbody.appendChild(row);
            });
        }

        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchResult = document.getElementById('searchResult');

            searchInput.addEventListener('keyup', function() {
                const keyword = this.value.trim();
                if (keyword.length < 1) { searchResult.style.display = 'none'; return; }

                // ê¸°ì¡´ì— ë§Œë“  ê²€ìƒ‰ API í™œìš©
                fetch(`/api/stock/search?keyword=${keyword}`)
                    .then(res => res.json())
                    .then(list => {
                        searchResult.innerHTML = '';
                        if (list.length > 0) {
                            searchResult.style.display = 'block';
                            list.forEach(stock => {
                                const li = document.createElement('li');
                                li.textContent = `${stock.name} (${stock.code})`;
                                li.onclick = () => {
                                    // ì„ íƒ ì‹œ ì°¨íŠ¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ë©´ì„œ ë°ì´í„° ì „ë‹¬
                                    // (ê°„ë‹¨í•˜ê²Œ localStorage ì‚¬ìš©, ì‹¤ì œë¡œëŠ” URL Query Parameter ì¶”ì²œ)
                                    localStorage.setItem('selectedCode', stock.code);
                                    localStorage.setItem('selectedName', stock.name);
                                    window.location.href = '/chart'; 
                                };
                                searchResult.appendChild(li);
                            });
                        } else {
                            searchResult.style.display = 'none';
                        }
                    });
            });
            
            // ì™¸ë¶€ í´ë¦­ ì‹œ ê²€ìƒ‰ì°½ ë‹«ê¸°
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !searchResult.contains(e.target)) {
                    searchResult.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>